services:
  # --- 1. Base de donn√©es NoSQL (Notes) ---
  mongodb:
    image: mongo:latest
    container_name: mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

  # --- 2. Patient Service (SQL H2) ---
  patient-service:
    build: ./patient-service
    container_name: patient-service
    ports:
      - "9001:9001"
    environment:
      - SERVER_PORT=9001

  # --- 3. Note Service (NoSQL Mongo) ---
  note-service:
    build: ./note-service
    container_name: note-service
    ports:
      - "9002:9002"
    environment:
      - SERVER_PORT=9002
      - SPRING_DATA_MONGODB_HOST=mongodb
      - SPRING_DATA_MONGODB_PORT=27017
    depends_on:
      - mongodb

  # --- 4. Assessment Service (Le Cerveau) ---
  assessment-service:
    build: ./assessment-service
    container_name: assessment-service
    ports:
      - "8081:8081"
    environment:
      - SERVER_PORT=8081
      - PATIENT_SERVICE_URL=http://patient-service:9001
      - NOTE_SERVICE_URL=http://note-service:9002
    depends_on:
      - patient-service
      - note-service

  # --- 5. Gateway Service (Le Routeur) ---
  gateway-service:
    build: ./gateway-service
    container_name: gateway-service
    ports:
      - "9004:9004"
    environment:
      - SERVER_PORT=9004
      # On passe juste les URLs, le fichier application.yml fera le reste
      - PATIENT_SERVICE_URL=http://patient-service:9001
      - NOTE_SERVICE_URL=http://note-service:9002
      - ASSESSMENT_SERVICE_URL=http://assessment-service:8081
    depends_on:
      - patient-service
      - note-service
      - assessment-service

  # --- 6. Client UI (Le Front-End) ---
  client-ui:
    build: ./client-ui
    container_name: client-ui
    ports:
      - "8080:8080"
    environment:
      - SERVER_PORT=8080
      - GATEWAY_URL=http://gateway-service:9004
    depends_on:
      - gateway-service

volumes:
  mongo-data: